
<!-- README.md is generated from README.Rmd. Please edit that file -->

# Mental Health Surge Modelling [<img src="https://www.strategyunitwm.nhs.uk/themes/custom/ie_bootstrap/logo.svg" title="The Strategy Unit" alt="The Strategy Unit Logo" align="right" height="80"/>](https://www.strategyunitwm.nhs.uk/)

<!-- badges: start -->

[![Lifecycle:
maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![R build
status](https://github.com/The-Strategy-Unit/723_mh_covid_surge_modelling/workflows/R-CMD-check/badge.svg)](https://github.com/The-Strategy-Unit/723_mh_covid_surge_modelling/actions)

[![Codecov test
coverage](https://codecov.io/gh/The-Strategy-Unit/723_mh_covid_surge_modelling/branch/master/graph/badge.svg)](https://codecov.io/gh/The-Strategy-Unit/723_mh_covid_surge_modelling?branch=master)
<!-- badges: end -->

This package is a Shiny application to model the surge in mental health
needs caused by the COVID-19 pandemic. It is hosted at
[strategyunit.shinyapps.io/MH\_Surge\_Modelling](https://strategyunit.shinyapps.io/MH_Surge_Modelling/).
Documentation for the code is available at
[the-strategy-unit.github.io/723\_mh\_covid\_surge\_modelling](https://the-strategy-unit.github.io/723_mh_covid_surge_modelling/index.html).

The model framework has been guided by literature reviews and expert
opinions. Data on population groups is sourced from both routine and
local data and variables for the model are based on a mixture of Trust
returns and extracts from
[MHSDS](https://data.england.nhs.uk/ncdr/database/NHSE_MH_V3_YTD/ "Mental health data (MHSDS v3)")
and
[IAPT](https://data.england.nhs.uk/ncdr/database/NHSE_IAPT/ "Improving access to psychological therapies (IAPT)")
datasets within
[NCDR](https://data.england.nhs.uk/ncdr/about/ "National Commissioning Data Repository (NCDR)").

## Usage

``` r
devtools::install_github("The-Strategy-Unit/723_mh_covid_surge_modelling")
mhSurgeModelling::run_app()
```

## Project Structure

This package uses the [`{golem}`](https://github.com/ThinkR-open/golem)
framework. All of the code is organised in the `R/` folder. The files
are structured in the following way:

  - `app_*.R` files are the main application files

  - `run_app.R` is generated by the
    [`{golem}`](https://github.com/ThinkR-open/golem) framework and
    run’s the entire application

  - `module_*.R` files are the shiny modules for the application: each
    “page” has it’s own module. These files contain both the `ui` and
    `server` functions for that module

  - `plot_*.R` files contain the code to produce the data for plots and
    the corresponding plot function. All plots for the application are
    generated using the [`{plotly}`](https://plotly.com/r/) package

  - `utils_*.R` files contain the functions and utilities that are
    required by the application

  - `ZZZ.R` contains extra code, such as what variables to load into the
    global environment at start up

Data files required at runtime by the application are stored in the
`inst/app/data` folder:

  - `params_help.json` contains the help text used on the `params` page

  - `params.xlsx` is the default parameters file for Mersey Care

  - `report.Rmd` is a RMarkdown report used to generate a `.pdf`
    download from the application

## Developing

If you wish to run this locally, first make a [fork in
GitHub](https://docs.github.com/en/free-pro-team@latest/github/getting-started-with-github/fork-a-repo).
You can then
[clone](https://happygitwithr.com/rstudio-git-github.html#clone-the-new-github-repository-to-your-computer-via-rstudio)
the repository directly in RStudio.

Once you have the repository cloned, you need to make sure that you have
all of the package’s dependencies installed:

``` r
remotes::install_deps(dependencies = TRUE)
```

Once the dependencies are installed the quickest way to run the
application is to run the script `dev/run_dev.R`.

``` r
source("dev/run_dev.R", echo = TRUE)
```

As this is a package you need to follow package development practices;
reading the [r-pkgs](https://r-pkgs.org/index.html) book is a great
start. In particular, make sure any dependecies on other packages are
stated in the `DESCRIPTION` file and any functions that you are
importing are described using [roxygen2](https://roxygen2.r-lib.org/).

The `devtools` package is very useful to use during development. You can
load the package to test code quickly using `devtools::load_all()`, and
documentation can be re-created using `devtools::document()`. It is
worth running the latter anytime you change code, especially when adding
new functions or imports.

It is also worth regularly running
[r-cmd-check](https://r-pkgs.org/r-cmd-check.html) to quickly identify
issues.

The package documentation is built using
[pkgdown](https://pkgdown.r-lib.org/). This is done automatically on
[deployment](#deployment), but you can view locally by running
`pkgdown::build_site()`.

## Contributing

Contributions are welcome, but please note that this tool was developed
for a specific project, so we may not be able to accept all changes.
Please file an
[issue](https://github.com/The-Strategy-Unit/723_mh_covid_surge_modelling/issues/new)
to discuss any bugs or changes before filing a pull request.

## Deployment

This package has been configured to use
[CI/CD](https://en.wikipedia.org/wiki/CI/CD) with [GitHub
Actions](https://github.com/features/actions). There are currently 4
actions:

  - [lintr](https://github.com/jimhester/lintr) runs static code
    analysis to check for syntactical errors and code styling issues.
    This runs on all commits.
  - [r-cmd-check](https://r-pkgs.org/r-cmd-check.html) runs R CMD CHECK.
    This runs on all commits.
  - shiny deploy runs only on successful PR’s to master and deploys the
    [application](https://strategyunit.shinyapps.io/MH_Surge_Modelling/).
  - [pkgdown](https://pkgdown.r-lib.org/) runs only on successful PR’s
    to master and deploys the
    [documentation](https://the-strategy-unit.github.io/723_mh_covid_surge_modelling/index.html).
